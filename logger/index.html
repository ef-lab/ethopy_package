
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Python Boilerplate contains all the boilerplate you need to create a Python package.">
      
      
        <meta name="author" content="olakiril, alexevag">
      
      
        <link rel="canonical" href="https://ef-lab.github.io/ethopy_package/logger/">
      
      
        <link rel="prev" href="../examples/intro/">
      
      
        <link rel="next" href="../behavior/">
      
      
      <link rel="icon" href="../assets/LabPageBrain.gif">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.25">
    
    
      
        <title>Logger module - EthoPy</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Google+Sans:300,300i,400,400i,700,700i%7CRegular:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Google Sans";--md-code-font:"Regular"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#core-logger-module" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="EthoPy" class="md-header__button md-logo" aria-label="EthoPy" data-md-component="logo">
      
  <img src="../assets/LabPageBrain.gif" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EthoPy
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Logger module
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ef-lab/ethopy_package" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="EthoPy" class="md-nav__button md-logo" aria-label="EthoPy" data-md-component="logo">
      
  <img src="../assets/LabPageBrain.gif" alt="logo">

    </a>
    EthoPy
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ef-lab/ethopy_package" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../local_conf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Local congiguration
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../database/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Database Setup
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../task/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plugin System
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/ef-lab/ethopy_package/issues" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Report Issues
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intro
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" checked>
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Logger module
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Logger module
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ethopy.core.logger" class="md-nav__link">
    <span class="md-ellipsis">
      ethopy.core.logger
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger" class="md-nav__link">
    <span class="md-ellipsis">
      Logger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.task_path" class="md-nav__link">
    <span class="md-ellipsis">
      task_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.acquire_lock" class="md-nav__link">
    <span class="md-ellipsis">
      acquire_lock()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      cleanup()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.closeDatasets" class="md-nav__link">
    <span class="md-ellipsis">
      closeDatasets()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.createDataset" class="md-nav__link">
    <span class="md-ellipsis">
      createDataset()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.get" class="md-nav__link">
    <span class="md-ellipsis">
      get()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.get_inner_classes_list" class="md-nav__link">
    <span class="md-ellipsis">
      get_inner_classes_list()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.get_ip" class="md-nav__link">
    <span class="md-ellipsis">
      get_ip()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.get_setup_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_setup_info()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.get_table_keys" class="md-nav__link">
    <span class="md-ellipsis">
      get_table_keys()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.get_task" class="md-nav__link">
    <span class="md-ellipsis">
      get_task()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.log" class="md-nav__link">
    <span class="md-ellipsis">
      log()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.log_recording" class="md-nav__link">
    <span class="md-ellipsis">
      log_recording()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.log_session" class="md-nav__link">
    <span class="md-ellipsis">
      log_session()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.log_session_configs" class="md-nav__link">
    <span class="md-ellipsis">
      log_session_configs()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.put" class="md-nav__link">
    <span class="md-ellipsis">
      put()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.setup_schema" class="md-nav__link">
    <span class="md-ellipsis">
      setup_schema()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.update_setup_info" class="md-nav__link">
    <span class="md-ellipsis">
      update_setup_info()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.update_trial_idx" class="md-nav__link">
    <span class="md-ellipsis">
      update_trial_idx()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ethopy.core.logger.PrioritizedItem" class="md-nav__link">
    <span class="md-ellipsis">
      PrioritizedItem
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../behavior/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Behavior module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../experiment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Experiment module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../interface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interface module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stimulus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stimulus module
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ethopy.core.logger" class="md-nav__link">
    <span class="md-ellipsis">
      ethopy.core.logger
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger" class="md-nav__link">
    <span class="md-ellipsis">
      Logger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.task_path" class="md-nav__link">
    <span class="md-ellipsis">
      task_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.acquire_lock" class="md-nav__link">
    <span class="md-ellipsis">
      acquire_lock()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      cleanup()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.closeDatasets" class="md-nav__link">
    <span class="md-ellipsis">
      closeDatasets()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.createDataset" class="md-nav__link">
    <span class="md-ellipsis">
      createDataset()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.get" class="md-nav__link">
    <span class="md-ellipsis">
      get()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.get_inner_classes_list" class="md-nav__link">
    <span class="md-ellipsis">
      get_inner_classes_list()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.get_ip" class="md-nav__link">
    <span class="md-ellipsis">
      get_ip()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.get_setup_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_setup_info()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.get_table_keys" class="md-nav__link">
    <span class="md-ellipsis">
      get_table_keys()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.get_task" class="md-nav__link">
    <span class="md-ellipsis">
      get_task()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.log" class="md-nav__link">
    <span class="md-ellipsis">
      log()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.log_recording" class="md-nav__link">
    <span class="md-ellipsis">
      log_recording()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.log_session" class="md-nav__link">
    <span class="md-ellipsis">
      log_session()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.log_session_configs" class="md-nav__link">
    <span class="md-ellipsis">
      log_session_configs()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.put" class="md-nav__link">
    <span class="md-ellipsis">
      put()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.setup_schema" class="md-nav__link">
    <span class="md-ellipsis">
      setup_schema()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.update_setup_info" class="md-nav__link">
    <span class="md-ellipsis">
      update_setup_info()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ethopy.core.logger.Logger.update_trial_idx" class="md-nav__link">
    <span class="md-ellipsis">
      update_trial_idx()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ethopy.core.logger.PrioritizedItem" class="md-nav__link">
    <span class="md-ellipsis">
      PrioritizedItem
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                



                  

  
  


<h1 id="core-logger-module">Core Logger module<a class="headerlink" href="#core-logger-module" title="Permanent link">&para;</a></h1>


  <div class="doc doc-object doc-module">

<a id="ethopy.core.logger"></a>
    <div class="doc doc-contents first">




  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h2 id="ethopy.core.logger.Logger" class="doc doc-heading">
        <code>
Logger        </code>



<a href="#ethopy.core.logger.Logger" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Logger class for managing logging and data handling in an experimental setup.</p>
<p>This class is designed to handle the logging of experimental data, manage database
connections, and control the flow of data from source to target locations. It
supports both manual and automatic running modes of a session, integrates with a
Python logging setup, and manages threads for data insertion and setup status
updates.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>setup</code></td>
        <td><code>str</code></td>
        <td><p>The hostname of the machine running the experiment.</p></td>
      </tr>
      <tr>
        <td><code>is_pi</code></td>
        <td><code>bool</code></td>
        <td><p>Flag indicating if the current machine is a Raspberry Pi.</p></td>
      </tr>
      <tr>
        <td><code>task_idx</code></td>
        <td><code>int</code></td>
        <td><p>Task index</p></td>
      </tr>
      <tr>
        <td><code>task_path</code></td>
        <td><code>str</code></td>
        <td><p>Path to the task file.</p></td>
      </tr>
      <tr>
        <td><code>manual_run</code></td>
        <td><code>bool</code></td>
        <td><p>Flag indicating if the experiment is run manually.</p></td>
      </tr>
      <tr>
        <td><code>setup_status</code></td>
        <td><code>str</code></td>
        <td><p>Current status of the setup (e.g. 'running', 'ready').</p></td>
      </tr>
      <tr>
        <td><code>private_conn</code></td>
        <td><code>Connection</code></td>
        <td><p>Connection for internal database communication.</p></td>
      </tr>
      <tr>
        <td><code>writer</code></td>
        <td><code>Writer</code></td>
        <td><p>Writer class instance for handling data writing.</p></td>
      </tr>
      <tr>
        <td><code>rec_fliptimes</code></td>
        <td><code>bool</code></td>
        <td><p>Flag indicating if flip times should be recorded.</p></td>
      </tr>
      <tr>
        <td><code>trial_key</code></td>
        <td><code>dict</code></td>
        <td><p>Dictionary containing identifiers for the current trial.</p></td>
      </tr>
      <tr>
        <td><code>setup_info</code></td>
        <td><code>dict</code></td>
        <td><p>Dictionary containing setup information.</p></td>
      </tr>
      <tr>
        <td><code>datasets</code></td>
        <td><code>dict</code></td>
        <td><p>Dictionary containing datasets.</p></td>
      </tr>
      <tr>
        <td><code>lock</code></td>
        <td><code>bool</code></td>
        <td><p>Lock flag for thread synchronization.</p></td>
      </tr>
      <tr>
        <td><code>queue</code></td>
        <td><code>PriorityQueue</code></td>
        <td><p>Queue for managing data insertion order.</p></td>
      </tr>
      <tr>
        <td><code>ping_timer</code></td>
        <td><code>Timer</code></td>
        <td><p>Timer for managing pings.</p></td>
      </tr>
      <tr>
        <td><code>logger_timer</code></td>
        <td><code>Timer</code></td>
        <td><p>Timer for managing logging intervals.</p></td>
      </tr>
      <tr>
        <td><code>total_reward</code></td>
        <td><code>int</code></td>
        <td><p>Total reward accumulated.</p></td>
      </tr>
      <tr>
        <td><code>curr_state</code></td>
        <td><code>str</code></td>
        <td><p>Current state of the logger.</p></td>
      </tr>
      <tr>
        <td><code>thread_exception</code></td>
        <td><code>Exception</code></td>
        <td><p>Exception caught in threads, if any.</p></td>
      </tr>
      <tr>
        <td><code>source_path</code></td>
        <td><code>str</code></td>
        <td><p>Path where data are saved.</p></td>
      </tr>
      <tr>
        <td><code>target_path</code></td>
        <td><code>str</code></td>
        <td><p>Path where data will be moved after the session ends.</p></td>
      </tr>
      <tr>
        <td><code>thread_end</code></td>
        <td><code>Event</code></td>
        <td><p>Event to signal thread termination.</p></td>
      </tr>
      <tr>
        <td><code>thread_lock</code></td>
        <td><code>Lock</code></td>
        <td><p>Lock for thread synchronization.</p></td>
      </tr>
      <tr>
        <td><code>inserter_thread</code></td>
        <td><code>Thread</code></td>
        <td><p>Thread for inserting data into the database.</p></td>
      </tr>
      <tr>
        <td><code>getter_thread</code></td>
        <td><code>Thread</code></td>
        <td><p>Thread for periodically updating setup status.</p></td>
      </tr>
  </tbody>
</table>      <div class="admonition methods">
<p class="admonition-title">Methods</p>
<p><strong>init</strong>(task=False): Initializes the Logger instance.
_check_if_raspberry_pi(): Checks if the current machine is a Raspberry Pi.
_inserter(): Inserts data into the database.
_log_setup_info(setup, status): Logs setup information.
_get_setup_status(): Get setup status.</p>
</div>

        <details class="quote">
          <summary>Source code in <code>ethopy/core/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Logger</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Logger class for managing logging and data handling in an experimental setup.</span>

<span class="sd">    This class is designed to handle the logging of experimental data, manage database</span>
<span class="sd">    connections, and control the flow of data from source to target locations. It</span>
<span class="sd">    supports both manual and automatic running modes of a session, integrates with a</span>
<span class="sd">    Python logging setup, and manages threads for data insertion and setup status</span>
<span class="sd">    updates.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        setup (str): The hostname of the machine running the experiment.</span>
<span class="sd">        is_pi (bool): Flag indicating if the current machine is a Raspberry Pi.</span>
<span class="sd">        task_idx (int): Task index</span>
<span class="sd">        task_path (str): Path to the task file.</span>
<span class="sd">        manual_run (bool): Flag indicating if the experiment is run manually.</span>
<span class="sd">        setup_status (str): Current status of the setup (e.g. &#39;running&#39;, &#39;ready&#39;).</span>
<span class="sd">        private_conn (Connection): Connection for internal database communication.</span>
<span class="sd">        writer (Writer): Writer class instance for handling data writing.</span>
<span class="sd">        rec_fliptimes (bool): Flag indicating if flip times should be recorded.</span>
<span class="sd">        trial_key (dict): Dictionary containing identifiers for the current trial.</span>
<span class="sd">        setup_info (dict): Dictionary containing setup information.</span>
<span class="sd">        datasets (dict): Dictionary containing datasets.</span>
<span class="sd">        lock (bool): Lock flag for thread synchronization.</span>
<span class="sd">        queue (PriorityQueue): Queue for managing data insertion order.</span>
<span class="sd">        ping_timer (Timer): Timer for managing pings.</span>
<span class="sd">        logger_timer (Timer): Timer for managing logging intervals.</span>
<span class="sd">        total_reward (int): Total reward accumulated.</span>
<span class="sd">        curr_state (str): Current state of the logger.</span>
<span class="sd">        thread_exception (Exception): Exception caught in threads, if any.</span>
<span class="sd">        source_path (str): Path where data are saved.</span>
<span class="sd">        target_path (str): Path where data will be moved after the session ends.</span>
<span class="sd">        thread_end (Event): Event to signal thread termination.</span>
<span class="sd">        thread_lock (Lock): Lock for thread synchronization.</span>
<span class="sd">        inserter_thread (Thread): Thread for inserting data into the database.</span>
<span class="sd">        getter_thread (Thread): Thread for periodically updating setup status.</span>

<span class="sd">    Methods:</span>
<span class="sd">        __init__(task=False): Initializes the Logger instance.</span>
<span class="sd">        _check_if_raspberry_pi(): Checks if the current machine is a Raspberry Pi.</span>
<span class="sd">        _inserter(): Inserts data into the database.</span>
<span class="sd">        _log_setup_info(setup, status): Logs setup information.</span>
<span class="sd">        _get_setup_status(): Get setup status.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_pi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_if_raspberry_pi</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="n">task</span> <span class="ow">or</span> <span class="n">Task</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manual_run</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">path</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_status</span> <span class="o">=</span> <span class="s1">&#39;running&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">manual_run</span> <span class="k">else</span> <span class="s1">&#39;ready&#39;</span>

        <span class="c1"># separate connection for internal communication</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_schemata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">private_conn</span> <span class="o">=</span> <span class="n">create_virtual_modules</span><span class="p">(</span>
            <span class="n">SCHEMATA</span><span class="p">,</span> <span class="n">create_tables</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">create_schema</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="n">Writer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec_fliptimes</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;animal_id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;session&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;trial_idx&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">PriorityQueue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ping_timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger_timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curr_state</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread_exception</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># source path is the local path that data are saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_path</span> <span class="o">=</span> <span class="n">local_conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source_path&quot;</span><span class="p">)</span>
        <span class="c1"># target path is the path that data will be moved after the session ends</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_path</span> <span class="o">=</span> <span class="n">local_conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;target_path&quot;</span><span class="p">)</span>

        <span class="c1"># inserter_thread read the queue and insert the data in the database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread_end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">(),</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inserter_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_inserter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inserter_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># _log_setup_info needs to run after the inserter_thread is started</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_setup_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_status</span><span class="p">)</span>

        <span class="c1"># before starting the getter thread we need to _log_setup_info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sync_control_table</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger_timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">task_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the task path.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">path</span>

    <span class="k">def</span> <span class="nf">get_task</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the task configuration.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if task is available and valid</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">manual_run</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="n">resolve_task</span><span class="p">(</span><span class="n">task_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_setup_info</span><span class="p">(</span><span class="s1">&#39;task_idx&#39;</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_check_if_raspberry_pi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">uname</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">system</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;arm&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">system</span><span class="o">.</span><span class="n">machine</span> <span class="o">==</span> <span class="s2">&quot;aarch64&quot;</span>
            <span class="k">if</span> <span class="n">system</span><span class="o">.</span><span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;Linux&quot;</span>
            <span class="k">else</span> <span class="kc">False</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra_schema</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up additional schema.</span>

<span class="sd">        Args:</span>
<span class="sd">            extra_schema (Dict[str, Any]): The additional schema to set up.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">schema</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">extra_schema</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">globals</span><span class="p">()[</span><span class="n">schema</span><span class="p">]</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">create_virtual_module</span><span class="p">(</span>
                <span class="n">schema</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">create_tables</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">create_schema</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_schemata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="n">schema</span><span class="p">:</span> <span class="n">dj</span><span class="o">.</span><span class="n">create_virtual_module</span><span class="p">(</span>
                        <span class="n">schema</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">private_conn</span>
                    <span class="p">)</span>
                <span class="p">}</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Put an item in the queue.</span>

<span class="sd">        This method creates a `PrioritizedItem` from the given keyword arguments and</span>
<span class="sd">        puts it into the queue. After putting an item in the queue, it checks the</span>
<span class="sd">        &#39;block&#39; attribute of the item. If &#39;block&#39; is False, it marks the item as</span>
<span class="sd">        processed by calling `task_done()`. This is useful in scenarios where items are</span>
<span class="sd">        processed asynchronously, and the queue needs to be notified that a task is</span>
<span class="sd">        complete. If &#39;block&#39; is True, it waits for all items in the queue to be</span>
<span class="sd">        processed by calling `join()`.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs (Any): The keyword arguments used to create a `PrioritizedItem` and</span>
<span class="sd">                put it in the queue.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">PrioritizedItem</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">block</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_insert_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Insert an item into the specified table.</span>

<span class="sd">        Args:</span>
<span class="sd">            item: The item to be inserted.</span>
<span class="sd">            table: The table to insert the item into.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span>
            <span class="n">item</span><span class="o">.</span><span class="n">tuple</span><span class="p">,</span>
            <span class="n">ignore_extra_fields</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">ignore_extra_fields</span><span class="p">,</span>
            <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">False</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">replace</span> <span class="k">else</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">replace</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">replace</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate an item against a table.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">validate</span><span class="p">:</span>  <span class="c1"># validate tuple exists in database</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">tuple</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">primary_key</span><span class="p">}</span>
            <span class="k">if</span> <span class="s2">&quot;status&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">tuple</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">tuple</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">table</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_insert_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">exception</span><span class="p">,</span> <span class="n">queue</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle databse insert errors.</span>

<span class="sd">        Handles an error by logging the error message, set the item.error=True, increase</span>
<span class="sd">        priority and add the item again in the queue for re-trying to insert later.</span>

<span class="sd">        Args:</span>
<span class="sd">            item : Description of parameter `item`.</span>
<span class="sd">            table : Description of parameter `table`.</span>
<span class="sd">            exception (Exception): The exception that was raised.</span>
<span class="sd">            thread_end : Description of parameter `thread_end`.</span>
<span class="sd">            queue : Description of parameter `queue`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Failed to insert:</span><span class="se">\n</span><span class="si">%s</span><span class="s2"> in </span><span class="si">%s</span><span class="se">\n</span><span class="s2"> With error:</span><span class="si">%s</span><span class="se">\n</span><span class="s2">Will retry later&quot;</span><span class="p">,</span>
            <span class="n">item</span><span class="o">.</span><span class="n">tuple</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">exception</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">item</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">priority</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">acquire_lock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lock</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Acquire a lock, yield control, and release the lock.</span>

<span class="sd">        This context manager ensures that the given lock is acquired before</span>
<span class="sd">        entering the block of code and released after exiting the block, even</span>
<span class="sd">        if an exception is raised within the block.</span>

<span class="sd">        Args:</span>
<span class="sd">            lock (threading.Lock): The lock object to acquire and release.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_inserter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Insert continuously items from the queue into their respective tables.</span>

<span class="sd">        It runs in a loop until the thread_end event is set. In each iteration, it</span>
<span class="sd">        checks if the queue is empty. If it is, it sleeps for 0.5 seconds and then</span>
<span class="sd">        continues to the next iteration.</span>
<span class="sd">        If the queue is not empty, it gets an item from the queue, acquires the thread</span>
<span class="sd">        lock, and tries to insert the item into it&#39;s table.</span>
<span class="sd">        If an error occurs during the insertion, it handles the error. After the</span>
<span class="sd">        insertion, it releases the thread lock. If the item was marked to block, it</span>
<span class="sd">        marks the task as done.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_end</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">rgetattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_schemata</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">schema</span><span class="p">],</span> <span class="n">item</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquire_lock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thread_lock</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_insert_item</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_item</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">insert_error</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">thread_end</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                            <span class="s2">&quot;Second time failed to insert:</span><span class="se">\n</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> in </span><span class="si">%s</span><span class="s2"> With error:</span><span class="se">\n</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">item</span><span class="o">.</span><span class="n">tuple</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">insert_error</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">thread_exception</span> <span class="o">=</span> <span class="n">insert_error</span>
                        <span class="k">break</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_handle_insert_error</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">insert_error</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">block</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_sync_control_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_period</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Synchronize the Control table.</span>

<span class="sd">        Synchronize the Control table by continuously fetching the setup status</span>
<span class="sd">        from the experiment schema and periodically updating the setup info.</span>

<span class="sd">        Runs in a loop until the thread_end event is set.</span>

<span class="sd">        Args:</span>
<span class="sd">            update_period (float): Time in milliseconds between Control table updates.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_end</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_lock</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
                    <span class="k">continue</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_setup_info</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_setup_info</span><span class="p">(</span><span class="n">update_period</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error during Control table sync: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">thread_exception</span> <span class="o">=</span> <span class="n">error</span>

            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Cycle once a second</span>

    <span class="k">def</span> <span class="nf">_fetch_setup_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_info</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_schemata</span><span class="p">[</span><span class="s2">&quot;experiment&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">Control</span><span class="p">()</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;setup&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_info</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_update_setup_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_period</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the setup information if the elapsed time exceeds the update period.</span>

<span class="sd">        This method checks if the elapsed time since the last ping exceeds the given</span>
<span class="sd">        update period. If it does, it resets the ping timer and updates the setup</span>
<span class="sd">        information with the current state, queue size, trial index, total liquid</span>
<span class="sd">        reward, and the current timestamp. The updated information is then stored</span>
<span class="sd">        in the &quot;Control&quot; table with a priority of 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ping_timer</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">update_period</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ping_timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;last_ping&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">),</span>
                <span class="s2">&quot;queue_size&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">qsize</span><span class="p">(),</span>
                <span class="s2">&quot;trials&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">[</span><span class="s2">&quot;trial_idx&quot;</span><span class="p">],</span>
                <span class="s2">&quot;total_liquid&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span><span class="p">,</span>
                <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">curr_state</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="s2">&quot;Control&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">setup_info</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log the given data into the specified table in the experiment database.</span>

<span class="sd">        It first gets the elapsed time from the logger timer and adds it to the data</span>
<span class="sd">        dictionary. It then puts the data into the specified table.</span>

<span class="sd">        Args:</span>
<span class="sd">            table (str): The name of the table in the experiment database.</span>
<span class="sd">            data (dict, optional): The data to be logged. Defaults to an empty</span>
<span class="sd">                dictionary.</span>
<span class="sd">            **kwargs: Additional keyword arguments to be passed to the put method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The elapsed time from the logger timer.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tmst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger_timer</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="ow">or</span> <span class="p">{}</span>  <span class="c1"># if data is None or False use an empty dictionary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="p">,</span> <span class="nb">tuple</span><span class="o">=</span><span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">tmst</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">table</span> <span class="o">==</span> <span class="s2">&quot;Trial.StateOnset&quot;</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;State: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">tmst</span>

    <span class="k">def</span> <span class="nf">_log_setup_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">setup_status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;running&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log setup information into the Control table in the experiment database.</span>

<span class="sd">        It first fetches the control information for the current setup. If no control</span>
<span class="sd">        information is found, it creates a new dictionary with the setup information.</span>
<span class="sd">        It then adds the IP and status information to the key.</span>

<span class="sd">        The method finally puts the key into the Control table, replacing any existing</span>
<span class="sd">        entry. Because it blocks the queue until the operation is complete it needs the</span>
<span class="sd">        inserter_thread to be running.</span>

<span class="sd">        Args:</span>
<span class="sd">            setup (str): The setup name.</span>
<span class="sd">            setup_status (str): The current status fo the setup. Defaults to running.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rel</span> <span class="o">=</span> <span class="n">experiment</span><span class="o">.</span><span class="n">Control</span><span class="p">()</span> <span class="o">&amp;</span> <span class="nb">dict</span><span class="p">(</span><span class="n">setup</span><span class="o">=</span><span class="n">setup</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">rel</span><span class="o">.</span><span class="n">fetch1</span><span class="p">()</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">rel</span><span class="o">.</span><span class="n">fetch</span><span class="p">())</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">setup</span><span class="o">=</span><span class="n">setup</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ip</span><span class="p">(),</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">setup_status</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
            <span class="n">table</span><span class="o">=</span><span class="s2">&quot;Control&quot;</span><span class="p">,</span>
            <span class="nb">tuple</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
            <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_last_session</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch last session for a given animal_id from the experiment.</span>

<span class="sd">        It first fetches all sessions for the given animal_id. If no sessions are found,</span>
<span class="sd">        it returns 0.</span>
<span class="sd">        If sessions are found, it returns the maximum session number, which corresponds</span>
<span class="sd">        to the last session.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The last session number or 0 if no sessions are found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">last_sessions</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">experiment</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="o">&amp;</span> <span class="nb">dict</span><span class="p">(</span><span class="n">animal_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_setup_info</span><span class="p">(</span><span class="s2">&quot;animal_id&quot;</span><span class="p">))</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;session&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">last_sessions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">last_sessions</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">session_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
                    <span class="n">experiment_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="n">log_task</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log session with the given parameters and optionally log the task.</span>

<span class="sd">        Args:</span>
<span class="sd">            session_params (Dict[str, Any]): Parameters for the session.</span>
<span class="sd">            experiment_type (str): current experiment running in session.</span>
<span class="sd">            log_task (bool): Whether to log the task information.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initializes session parameters and logs the session start.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_session_params</span><span class="p">(</span><span class="n">session_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_name&quot;</span><span class="p">,</span> <span class="s2">&quot;bot&quot;</span><span class="p">),</span>
                                  <span class="n">experiment_type</span><span class="p">)</span>

        <span class="c1"># Save the task file, name and the git_hash in the database.</span>
        <span class="k">if</span> <span class="n">log_task</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_task_details</span><span class="p">()</span>

        <span class="c1"># update the configuration tables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_session_configs</span><span class="p">(</span><span class="n">session_params</span><span class="p">[</span><span class="s2">&quot;setup_conf_idx&quot;</span><span class="p">])</span>

        <span class="c1">#  Init the informations(e.g. trial_id=0, session) in control table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_control_table</span><span class="p">(</span><span class="n">session_params</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger_timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># Start session time</span>

    <span class="k">def</span> <span class="nf">_init_session_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">experiment_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize session parameters and log the session start.</span>

<span class="sd">        This method initializes the session parameters by setting the total reward to</span>
<span class="sd">        zero and creating a trial key with the animal ID, trial index set to zero, and</span>
<span class="sd">        the session number incremented by one from the last session. It logs the trial</span>
<span class="sd">        key and creates a session key by merging the trial key with the provided session</span>
<span class="sd">        parameters, setup information, and a default or provided user name. The session</span>
<span class="sd">        key is then logged and stored in the database.</span>

<span class="sd">        Args:</span>
<span class="sd">            user_name (Dict[str, Any]): A string defininng user.</span>
<span class="sd">            experiment_type: str: name of the expertiment.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_reward</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;animal_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_setup_info</span><span class="p">(</span><span class="s2">&quot;animal_id&quot;</span><span class="p">),</span>
                          <span class="s2">&quot;trial_idx&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                          <span class="s2">&quot;session&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_last_session</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span>

        <span class="n">session_key</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;animal_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_setup_info</span><span class="p">(</span><span class="s2">&quot;animal_id&quot;</span><span class="p">),</span>
                       <span class="s2">&quot;session&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_last_session</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                       <span class="s2">&quot;user_name&quot;</span><span class="p">:</span> <span class="n">user_name</span><span class="p">,</span>
                       <span class="s2">&quot;setup&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">,</span>
                       <span class="s2">&quot;experiment_type&quot;</span><span class="p">:</span> <span class="n">experiment_type</span>
                       <span class="p">}</span>

        <span class="c1"># Convert np.int64 values to native Python int</span>
        <span class="n">session_key_cleaned</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">session_key</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">figlet_format</span><span class="p">(</span><span class="s1">&#39;EthoPy&#39;</span><span class="p">))</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s%s%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">22</span><span class="p">,</span>
            <span class="s2">&quot; Basic Session informations &quot;</span><span class="p">,</span>
            <span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">22</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">session_key_cleaned</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>
            <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">72</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Logs the new session id to the database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
            <span class="n">table</span><span class="o">=</span><span class="s2">&quot;Session&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="o">=</span><span class="n">session_key</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_inner_classes_list</span><span class="p">(</span><span class="n">outer_class</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve a list of names of all inner classes defined within an outer class.</span>

<span class="sd">        Args:</span>
<span class="sd">            outer_class: The class object of the outer class containing the inner</span>
<span class="sd">                classes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of strings, each representing the fully qualified name of an inner</span>
<span class="sd">                class defined within the outer class.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outer_class_dict_values</span> <span class="o">=</span> <span class="n">outer_class</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="n">inner_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">outer_class_dict_values</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                                                                  <span class="nb">type</span><span class="p">)]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">outer_class</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">inner_classes</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">log_session_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup_conf_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log parameter of a session into the appropriate schema tables.</span>

<span class="sd">        This method performs several key operations to ensure that the configuration of</span>
<span class="sd">        a session, including behavior and stimulus settings, is accurately logged into</span>
<span class="sd">        the database. It involves the following steps:</span>
<span class="sd">        1. Identifies the relevant modules (e.g., ethopy.core.interface) that contain</span>
<span class="sd">        Configuration classes.</span>
<span class="sd">        2. Derives schema names from these modules, assuming the schema name matches the</span>
<span class="sd">        class name in lowercase.</span>
<span class="sd">        3. Logs the session and animal_id into the Configuration tables of the</span>
<span class="sd">        identified schemas.</span>
<span class="sd">        4. Creates a dictionary mapping each schema to its respective Configuration</span>
<span class="sd">        class&#39;s inner classes.</span>
<span class="sd">        5. Calls a helper method to log the configuration of sub-tables for each schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># modules that have a Configuration classes</span>
        <span class="n">_modules</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ethopy.core.interface&#39;</span><span class="p">]</span>
        <span class="c1"># consider that the module have the same name as the schema but in lower case</span>
        <span class="c1"># (e.g for class Behaviour the schema is the behavior)</span>
        <span class="n">_schemas</span> <span class="o">=</span> <span class="p">[</span><span class="n">_module</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">_module</span> <span class="ow">in</span> <span class="n">_modules</span><span class="p">]</span>

        <span class="c1"># Logs the session and animal_id in configuration tables of behavior/stimulus.</span>
        <span class="k">for</span> <span class="n">schema</span> <span class="ow">in</span> <span class="n">_schemas</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="s2">&quot;Configuration&quot;</span><span class="p">,</span>
                     <span class="nb">tuple</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">,</span>
                     <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
                     <span class="n">priority</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                     <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,)</span>

        <span class="c1"># create a dict with the configuration as key and the subclasses as values</span>
        <span class="n">conf_table_schema</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">_schema</span><span class="p">,</span> <span class="n">_module</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_schemas</span><span class="p">,</span> <span class="n">_modules</span><span class="p">):</span>
            <span class="n">conf</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">_module</span><span class="p">)</span><span class="o">.</span><span class="n">Configuration</span>
            <span class="c1"># Find the inner classes of the class Configuration</span>
            <span class="n">conf_table_schema</span><span class="p">[</span><span class="n">_schema</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inner_classes_list</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>

        <span class="c1"># update the sub tables of Configuration table</span>
        <span class="k">for</span> <span class="n">schema</span><span class="p">,</span> <span class="n">config_tables</span> <span class="ow">in</span> <span class="n">conf_table_schema</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_sub_tables_config</span><span class="p">(</span><span class="n">setup_conf_idx</span><span class="p">,</span> <span class="n">config_tables</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_sub_tables_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup_conf_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                               <span class="n">config_tables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log conifguration data in the respective tables.</span>

<span class="sd">        This method iterates over a list of configuration tables, retrieves the</span>
<span class="sd">        configuration data for each table based on the provided parameters, and then</span>
<span class="sd">        logs this data into the respective table within the given schema.</span>

<span class="sd">        Args:</span>
<span class="sd">            setup_conf_idx (int): index indication the setup configuration</span>
<span class="sd">            config_tables (list): The part table to be recorded (e.g., Port, Screen).</span>
<span class="sd">            schema (str): The schema for the configuration.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">config_table</span> <span class="ow">in</span> <span class="n">config_tables</span><span class="p">:</span>
            <span class="n">configuration_data</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">interface</span><span class="o">.</span><span class="n">SetupConfiguration</span><span class="p">,</span> <span class="n">config_table</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;setup_conf_idx&quot;</span><span class="p">:</span> <span class="n">setup_conf_idx</span><span class="p">}</span>
            <span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># put the configuration data in the configuration table</span>
            <span class="c1"># it can be a list of configurations (e.g have two ports with different ids)</span>
            <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="n">configuration_data</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
                    <span class="n">table</span><span class="o">=</span><span class="n">config_table</span><span class="p">,</span>
                    <span class="nb">tuple</span><span class="o">=</span><span class="p">{</span><span class="o">**</span><span class="n">conf</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">},</span>
                    <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_control_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the control table informations for the setup.</span>

<span class="sd">        This method sets various parameters related to the session setup, including</span>
<span class="sd">        session ID, number of trials, total liquid, difficulty level, and state. It also</span>
<span class="sd">        optionally sets start and stop times if they are provided in the `params`</span>
<span class="sd">        argument.</span>

<span class="sd">        The start and stop times are expected to be in &quot;%H:%M:%S&quot; format. If they are</span>
<span class="sd">        provided, this method calculates the time delta from &quot;00:00:00&quot; for each and</span>
<span class="sd">        updates the setup information accordingly.</span>

<span class="sd">        Args:</span>
<span class="sd">            params (Dict[str, Any]): A dictionary containing parameters for the session</span>
<span class="sd">            setup. This may include &#39;start_time&#39; and &#39;stop_time&#39; among other setup</span>
<span class="sd">            parameters.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;session&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">[</span><span class="s2">&quot;session&quot;</span><span class="p">],</span>
            <span class="s2">&quot;trials&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;total_liquid&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;difficulty&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1">#  TODO if task is the path of the config there is no update in Control table</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">id</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;task_idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">id</span>

        <span class="c1"># if in the start_time is defined in the configuration use this</span>
        <span class="c1"># otherwise use the Control table</span>
        <span class="k">if</span> <span class="s2">&quot;start_time&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">_tdelta</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                    <span class="s2">&quot;00:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;%H:%M:%S&quot;</span>
                <span class="p">)</span>
            <span class="n">key</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">_tdelta</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;start_time&quot;</span><span class="p">])),</span>
                    <span class="s2">&quot;stop_time&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">_tdelta</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;stop_time&quot;</span><span class="p">])),</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_setup_info</span><span class="p">({</span><span class="o">**</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_info</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]})</span>

    <span class="k">def</span> <span class="nf">update_setup_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">info</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
                          <span class="n">key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the setup information in Control table with the provided info and key.</span>

<span class="sd">        It first fetches the existing setup information from the experiment&#39;s Control</span>
<span class="sd">        table, then updates it with the provided info. If &#39;status&#39; is in the provided</span>
<span class="sd">        info, it blocks and validates the update operation.</span>

<span class="sd">        Args:</span>
<span class="sd">            info (dict): The information to update the setup with.</span>
<span class="sd">            key (dict, optional): Additional keys to fetch the setup information with.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Side Effects:</span>
<span class="sd">            Updates the setup_info attribute with the new setup information.</span>
<span class="sd">            Updates the setup_status attribute with the new status.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thread_exception</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Thread exception occurred: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_exception</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">public_conn</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
            <span class="n">_set_connection</span><span class="p">()</span>

        <span class="n">block</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="s2">&quot;status&quot;</span> <span class="ow">in</span> <span class="n">info</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            <span class="n">caller</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">caller_info</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Function called by </span><span class="si">{</span><span class="n">caller</span><span class="o">.</span><span class="n">function</span><span class="si">}</span><span class="s2"> &quot;</span>
                           <span class="sa">f</span><span class="s2">&quot;in </span><span class="si">{</span><span class="n">caller</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2"> at line </span><span class="si">{</span><span class="n">caller</span><span class="o">.</span><span class="n">lineno</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Update status is set </span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">],</span> <span class="n">caller_info</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="o">**</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">Control</span><span class="p">()</span> <span class="o">&amp;</span> <span class="p">{</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;setup&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">},</span> <span class="o">**</span><span class="n">key</span><span class="p">})</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(),</span>
            <span class="o">**</span><span class="n">info</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="s1">&#39;notes&#39;</span> <span class="ow">in</span> <span class="n">info</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;notes&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">:</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;notes&#39;</span><span class="p">][:</span><span class="mi">255</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
            <span class="n">table</span><span class="o">=</span><span class="s2">&quot;Control&quot;</span><span class="p">,</span>
            <span class="nb">tuple</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">setup_info</span><span class="p">,</span>
            <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">,</span>
            <span class="n">validate</span><span class="o">=</span><span class="n">block</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_info</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_log_task_details</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the task file, name and git_hash in the database.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">git_hash</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;git&quot;</span><span class="p">,</span> <span class="s2">&quot;rev-parse&quot;</span><span class="p">,</span> <span class="s2">&quot;--short&quot;</span><span class="p">,</span> <span class="s2">&quot;HEAD&quot;</span><span class="p">])</span>
                <span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">_hash</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">git_hash</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span>
            <span class="n">_hash</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;pip version </span><span class="si">{</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;git hash: </span><span class="si">{</span><span class="n">_hash</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
            <span class="n">table</span><span class="o">=</span><span class="s2">&quot;Session.Task&quot;</span><span class="p">,</span>
            <span class="nb">tuple</span><span class="o">=</span><span class="p">{</span>
                <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">,</span>
                <span class="s2">&quot;task_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_path</span><span class="p">,</span>
                <span class="s2">&quot;task_file&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_path</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">),</span>
                <span class="s2">&quot;git_hash&quot;</span><span class="p">:</span> <span class="nb">hash</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_setup_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve specific setup information from an experiment control table.</span>

<span class="sd">        Args:</span>
<span class="sd">            field (str): The name of the field to fetch from the experiment control</span>
<span class="sd">                setup.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The value of the specified field from the experiment control setup.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">Control</span><span class="p">()</span> <span class="o">&amp;</span> <span class="nb">dict</span><span class="p">(</span><span class="n">setup</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">))</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;experiment&#39;</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Control&#39;</span><span class="p">,</span>
        <span class="n">fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch data from a specified table in a schema.</span>

<span class="sd">        Args:</span>
<span class="sd">            schema (str): The schema to fetch data from. Defaults to &quot;experiment&quot;.</span>
<span class="sd">            table (str): The table to fetch data from. Defaults to &quot;Control&quot;.</span>
<span class="sd">            fields (dict): The fields to fetch. Defaults to &quot;&quot;.</span>
<span class="sd">            key (dict): The key used to fetch data. Defaults to an empty dict.</span>
<span class="sd">            **kwargs: Additional keyword arguments.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (numpy.ndarray): The fetched data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">rgetattr</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">schema</span><span class="p">),</span> <span class="n">table</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">table</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="o">*</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_table_keys</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;experiment&#39;</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Control&#39;</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">key_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the primary key of a specified table within a given schema.</span>

<span class="sd">        Args:</span>
<span class="sd">            schema (str): The schema name where the table is located. Default is</span>
<span class="sd">                &#39;experiment&#39;.</span>
<span class="sd">            table (str): The table name from which to retrieve the keys. Default is</span>
<span class="sd">                &#39;Control&#39;.</span>
<span class="sd">            key (dict): A dict with the key to filter the table. Default is an empty</span>
<span class="sd">                dictionary.</span>
<span class="sd">            key_type (str): type of keys to return from the table</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: The primary key of the specified table.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">rgetattr</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">schema</span><span class="p">),</span> <span class="n">table</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;primary&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">table</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">primary_key</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">table</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span>

    <span class="k">def</span> <span class="nf">update_trial_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update trial index.</span>

<span class="sd">        Updates the trial index in the trial_key dictionary and check if there is any</span>
<span class="sd">        exception in the threads.</span>

<span class="sd">        Args:</span>
<span class="sd">            trial_idx (int): The new trial index to be updated.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">[</span><span class="s1">&#39;trial_idx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trial_idx</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Trial idx: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">[</span><span class="s1">&#39;trial_idx&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thread_exception</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Thread exception occurred: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_exception</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wait for the logging queue to be empty and signals the logging thread to end.</span>

<span class="sd">        This method checks if the logging queue is empty, and if not, it waits until it</span>
<span class="sd">        becomes empty. Once the queue is empty, it sets the thread_end event to signal</span>
<span class="sd">        the logging thread to terminate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_end</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Waiting for empty queue... qsize: </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">qsize</span><span class="p">())</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread_end</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Clean up finished but queue size is: </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">qsize</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">createDataset</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span>
                    <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="n">dataset_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">,</span>
                    <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">db_log</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a dataset and return the dataset object.</span>

<span class="sd">        Args:</span>
<span class="sd">            dataset_name (str): The name of the dataset.</span>
<span class="sd">            dataset_type (type): The datatype of the dataset.</span>
<span class="sd">            filename (str, optional): The filename for the h5 file. If not provided,</span>
<span class="sd">                a default filename will be generated based on the dataset name,</span>
<span class="sd">                animal ID, session, and current timestamp.</span>
<span class="sd">            db_log (bool, optional): If True call the log_recording</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[str, Any]: A tuple containing the filename and the dataset object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recordings/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">[</span><span class="s1">&#39;animal_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_path</span> <span class="o">+</span> <span class="n">folder</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>  <span class="c1"># create path if necessary</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_path</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;No target directory set! Autocopying will not work.&#39;</span><span class="p">)</span>
            <span class="n">target_path</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">target_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_path</span> <span class="o">+</span> <span class="n">folder</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">target_path</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">target_path</span><span class="p">)</span>

        <span class="c1"># Generate filename if not provided</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">[</span><span class="s1">&#39;animal_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">-%H-%M-%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="c1"># create h5 file if not exists</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="n">target_path</span><span class="p">)</span>

        <span class="c1"># create new dataset in the h5 files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span><span class="o">.</span><span class="n">createDataset</span><span class="p">(</span>
            <span class="n">dataset_name</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dataset_type</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">db_log</span><span class="p">:</span>
            <span class="n">rec_key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">rec_aim</span><span class="o">=</span><span class="n">dataset_name</span><span class="p">,</span>
                <span class="n">software</span><span class="o">=</span><span class="s2">&quot;EthoPy&quot;</span><span class="p">,</span>
                <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                <span class="n">source_path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
                <span class="n">target_path</span><span class="o">=</span><span class="n">target_path</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_recording</span><span class="p">(</span><span class="n">rec_key</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">log_recording</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rec_key</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log a new recording entry with an incremented recording index.</span>

<span class="sd">        This method retrieves the current recordings associated with the trial,</span>
<span class="sd">        calculates the next recording index (rec_idx) by finding the maximum</span>
<span class="sd">        recording index and adding one, and logs the new recording entry with</span>
<span class="sd">        the provided recording key (rec_key) and the calculated recording index.</span>

<span class="sd">        Args:</span>
<span class="sd">            rec_key (dict): A dictionary containing the key information for the recording</span>
<span class="sd">        entry.</span>

<span class="sd">        The method assumes the existence of a `get` method to retrieve existing</span>
<span class="sd">        recordings and a `log` method to log the new recording entry.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">recs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">schema</span><span class="o">=</span><span class="s2">&quot;recording&quot;</span><span class="p">,</span>
            <span class="n">table</span><span class="o">=</span><span class="s2">&quot;Recording&quot;</span><span class="p">,</span>
            <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;rec_idx&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">rec_idx</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">recs</span> <span class="k">else</span> <span class="nb">max</span><span class="p">(</span><span class="n">recs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Recording&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="o">**</span><span class="n">rec_key</span><span class="p">,</span> <span class="s1">&#39;rec_idx&#39;</span><span class="p">:</span> <span class="n">rec_idx</span><span class="p">},</span> <span class="n">schema</span><span class="o">=</span><span class="s1">&#39;recording&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">closeDatasets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Close all datasets managed by this instance.</span>

<span class="sd">        Iterates through the datasets dictionary, calling the `exit` method on each</span>
<span class="sd">        dataset object to properly close them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dataset</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_ip</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the local IP address of the machine.</span>

<span class="sd">        Attempts to establish a dummy connection to a public DNS server (8.8.8.8) to</span>
<span class="sd">        determine the local network IP address of the machine. If the connection fails,</span>
<span class="sd">        defaults to localhost (127.0.0.1).</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The local IP address.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s2">&quot;8.8.8.8&quot;</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ip</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h3 id="ethopy.core.logger.Logger.task_path" class="doc doc-heading">
<code class="highlight language-python"><span class="n">task_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#ethopy.core.logger.Logger.task_path" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get the task path.</p>
    </div>

  </div>







  <div class="doc doc-object doc-method">



<h3 id="ethopy.core.logger.Logger.acquire_lock" class="doc doc-heading">
<code class="highlight language-python"><span class="n">acquire_lock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lock</span><span class="p">)</span></code>


<a href="#ethopy.core.logger.Logger.acquire_lock" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Acquire a lock, yield control, and release the lock.</p>
<p>This context manager ensures that the given lock is acquired before
entering the block of code and released after exiting the block, even
if an exception is raised within the block.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>lock</code></td>
        <td><code>threading.Lock</code></td>
        <td><p>The lock object to acquire and release.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ethopy/core/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">acquire_lock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Acquire a lock, yield control, and release the lock.</span>

<span class="sd">    This context manager ensures that the given lock is acquired before</span>
<span class="sd">    entering the block of code and released after exiting the block, even</span>
<span class="sd">    if an exception is raised within the block.</span>

<span class="sd">    Args:</span>
<span class="sd">        lock (threading.Lock): The lock object to acquire and release.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="ethopy.core.logger.Logger.cleanup" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#ethopy.core.logger.Logger.cleanup" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Wait for the logging queue to be empty and signals the logging thread to end.</p>
<p>This method checks if the logging queue is empty, and if not, it waits until it
becomes empty. Once the queue is empty, it sets the thread_end event to signal
the logging thread to terminate.</p>

        <details class="quote">
          <summary>Source code in <code>ethopy/core/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wait for the logging queue to be empty and signals the logging thread to end.</span>

<span class="sd">    This method checks if the logging queue is empty, and if not, it waits until it</span>
<span class="sd">    becomes empty. Once the queue is empty, it sets the thread_end event to signal</span>
<span class="sd">    the logging thread to terminate.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_end</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Waiting for empty queue... qsize: </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">qsize</span><span class="p">())</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">thread_end</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Clean up finished but queue size is: </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">qsize</span><span class="p">())</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="ethopy.core.logger.Logger.closeDatasets" class="doc doc-heading">
<code class="highlight language-python"><span class="n">closeDatasets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#ethopy.core.logger.Logger.closeDatasets" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Close all datasets managed by this instance.</p>
<p>Iterates through the datasets dictionary, calling the <code>exit</code> method on each
dataset object to properly close them.</p>

        <details class="quote">
          <summary>Source code in <code>ethopy/core/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">closeDatasets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Close all datasets managed by this instance.</span>

<span class="sd">    Iterates through the datasets dictionary, calling the `exit` method on each</span>
<span class="sd">    dataset object to properly close them.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="ethopy.core.logger.Logger.createDataset" class="doc doc-heading">
<code class="highlight language-python"><span class="n">createDataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">,</span> <span class="n">dataset_type</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">db_log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#ethopy.core.logger.Logger.createDataset" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Create a dataset and return the dataset object.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>dataset_name</code></td>
        <td><code>str</code></td>
        <td><p>The name of the dataset.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>dataset_type</code></td>
        <td><code>type</code></td>
        <td><p>The datatype of the dataset.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>filename</code></td>
        <td><code>str</code></td>
        <td><p>The filename for the h5 file. If not provided,
a default filename will be generated based on the dataset name,
animal ID, session, and current timestamp.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>db_log</code></td>
        <td><code>bool</code></td>
        <td><p>If True call the log_recording</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Tuple[str, Any]</code></td>
      <td><p>A tuple containing the filename and the dataset object.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ethopy/core/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">createDataset</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="n">dataset_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">,</span>
                <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">db_log</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a dataset and return the dataset object.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset_name (str): The name of the dataset.</span>
<span class="sd">        dataset_type (type): The datatype of the dataset.</span>
<span class="sd">        filename (str, optional): The filename for the h5 file. If not provided,</span>
<span class="sd">            a default filename will be generated based on the dataset name,</span>
<span class="sd">            animal ID, session, and current timestamp.</span>
<span class="sd">        db_log (bool, optional): If True call the log_recording</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[str, Any]: A tuple containing the filename and the dataset object.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">folder</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recordings/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">[</span><span class="s1">&#39;animal_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
              <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_path</span> <span class="o">+</span> <span class="n">folder</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>  <span class="c1"># create path if necessary</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_path</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;No target directory set! Autocopying will not work.&#39;</span><span class="p">)</span>
        <span class="n">target_path</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">target_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_path</span> <span class="o">+</span> <span class="n">folder</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">target_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">target_path</span><span class="p">)</span>

    <span class="c1"># Generate filename if not provided</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">[</span><span class="s1">&#39;animal_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">-%H-%M-%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
        <span class="c1"># create h5 file if not exists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="n">target_path</span><span class="p">)</span>

    <span class="c1"># create new dataset in the h5 files</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span><span class="o">.</span><span class="n">createDataset</span><span class="p">(</span>
        <span class="n">dataset_name</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dataset_type</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">db_log</span><span class="p">:</span>
        <span class="n">rec_key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">rec_aim</span><span class="o">=</span><span class="n">dataset_name</span><span class="p">,</span>
            <span class="n">software</span><span class="o">=</span><span class="s2">&quot;EthoPy&quot;</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">source_path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
            <span class="n">target_path</span><span class="o">=</span><span class="n">target_path</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_recording</span><span class="p">(</span><span class="n">rec_key</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="ethopy.core.logger.Logger.get" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="s1">&#39;experiment&#39;</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="s1">&#39;Control&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#ethopy.core.logger.Logger.get" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Fetch data from a specified table in a schema.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>schema</code></td>
        <td><code>str</code></td>
        <td><p>The schema to fetch data from. Defaults to "experiment".</p></td>
        <td><code>&#39;experiment&#39;</code></td>
      </tr>
      <tr>
        <td><code>table</code></td>
        <td><code>str</code></td>
        <td><p>The table to fetch data from. Defaults to "Control".</p></td>
        <td><code>&#39;Control&#39;</code></td>
      </tr>
      <tr>
        <td><code>fields</code></td>
        <td><code>dict</code></td>
        <td><p>The fields to fetch. Defaults to "".</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>key</code></td>
        <td><code>dict</code></td>
        <td><p>The key used to fetch data. Defaults to an empty dict.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Dict[str, Any]</code></td>
        <td><p>Additional keyword arguments.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>(numpy.ndarray)</code></td>
      <td><p>The fetched data.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ethopy/core/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;experiment&#39;</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Control&#39;</span><span class="p">,</span>
    <span class="n">fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch data from a specified table in a schema.</span>

<span class="sd">    Args:</span>
<span class="sd">        schema (str): The schema to fetch data from. Defaults to &quot;experiment&quot;.</span>
<span class="sd">        table (str): The table to fetch data from. Defaults to &quot;Control&quot;.</span>
<span class="sd">        fields (dict): The fields to fetch. Defaults to &quot;&quot;.</span>
<span class="sd">        key (dict): The key used to fetch data. Defaults to an empty dict.</span>
<span class="sd">        **kwargs: Additional keyword arguments.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (numpy.ndarray): The fetched data.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">rgetattr</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">schema</span><span class="p">),</span> <span class="n">table</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">table</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="o">*</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="ethopy.core.logger.Logger.get_inner_classes_list" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_inner_classes_list</span><span class="p">(</span><span class="n">outer_class</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ethopy.core.logger.Logger.get_inner_classes_list" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Retrieve a list of names of all inner classes defined within an outer class.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>outer_class</code></td>
        <td><code>Any</code></td>
        <td><p>The class object of the outer class containing the inner
classes.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[str]</code></td>
      <td><p>A list of strings, each representing the fully qualified name of an inner
    class defined within the outer class.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ethopy/core/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_inner_classes_list</span><span class="p">(</span><span class="n">outer_class</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve a list of names of all inner classes defined within an outer class.</span>

<span class="sd">    Args:</span>
<span class="sd">        outer_class: The class object of the outer class containing the inner</span>
<span class="sd">            classes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of strings, each representing the fully qualified name of an inner</span>
<span class="sd">            class defined within the outer class.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outer_class_dict_values</span> <span class="o">=</span> <span class="n">outer_class</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="n">inner_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">outer_class_dict_values</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                                                              <span class="nb">type</span><span class="p">)]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">outer_class</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">inner_classes</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="ethopy.core.logger.Logger.get_ip" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_ip</span><span class="p">()</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#ethopy.core.logger.Logger.get_ip" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Retrieve the local IP address of the machine.</p>
<p>Attempts to establish a dummy connection to a public DNS server (8.8.8.8) to
determine the local network IP address of the machine. If the connection fails,
defaults to localhost (127.0.0.1).</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The local IP address.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ethopy/core/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_ip</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve the local IP address of the machine.</span>

<span class="sd">    Attempts to establish a dummy connection to a public DNS server (8.8.8.8) to</span>
<span class="sd">    determine the local network IP address of the machine. If the connection fails,</span>
<span class="sd">    defaults to localhost (127.0.0.1).</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The local IP address.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s2">&quot;8.8.8.8&quot;</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ip</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="ethopy.core.logger.Logger.get_setup_info" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_setup_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span></code>


<a href="#ethopy.core.logger.Logger.get_setup_info" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Retrieve specific setup information from an experiment control table.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>field</code></td>
        <td><code>str</code></td>
        <td><p>The name of the field to fetch from the experiment control
setup.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>int64</code></td>
      <td><p>The value of the specified field from the experiment control setup.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ethopy/core/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_setup_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve specific setup information from an experiment control table.</span>

<span class="sd">    Args:</span>
<span class="sd">        field (str): The name of the field to fetch from the experiment control</span>
<span class="sd">            setup.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The value of the specified field from the experiment control setup.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">Control</span><span class="p">()</span> <span class="o">&amp;</span> <span class="nb">dict</span><span class="p">(</span><span class="n">setup</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">))</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="ethopy.core.logger.Logger.get_table_keys" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_table_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="s1">&#39;experiment&#39;</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="s1">&#39;Control&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#ethopy.core.logger.Logger.get_table_keys" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Retrieve the primary key of a specified table within a given schema.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>schema</code></td>
        <td><code>str</code></td>
        <td><p>The schema name where the table is located. Default is
'experiment'.</p></td>
        <td><code>&#39;experiment&#39;</code></td>
      </tr>
      <tr>
        <td><code>table</code></td>
        <td><code>str</code></td>
        <td><p>The table name from which to retrieve the keys. Default is
'Control'.</p></td>
        <td><code>&#39;Control&#39;</code></td>
      </tr>
      <tr>
        <td><code>key</code></td>
        <td><code>dict</code></td>
        <td><p>A dict with the key to filter the table. Default is an empty
dictionary.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>key_type</code></td>
        <td><code>str</code></td>
        <td><p>type of keys to return from the table</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>list</code></td>
      <td><p>The primary key of the specified table.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ethopy/core/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_table_keys</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;experiment&#39;</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Control&#39;</span><span class="p">,</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">key_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve the primary key of a specified table within a given schema.</span>

<span class="sd">    Args:</span>
<span class="sd">        schema (str): The schema name where the table is located. Default is</span>
<span class="sd">            &#39;experiment&#39;.</span>
<span class="sd">        table (str): The table name from which to retrieve the keys. Default is</span>
<span class="sd">            &#39;Control&#39;.</span>
<span class="sd">        key (dict): A dict with the key to filter the table. Default is an empty</span>
<span class="sd">            dictionary.</span>
<span class="sd">        key_type (str): type of keys to return from the table</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: The primary key of the specified table.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">rgetattr</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">schema</span><span class="p">),</span> <span class="n">table</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">key_type</span> <span class="o">==</span> <span class="s1">&#39;primary&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">table</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">primary_key</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">table</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="ethopy.core.logger.Logger.get_task" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_task</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#ethopy.core.logger.Logger.get_task" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get the task configuration.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>True if task is available and valid</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ethopy/core/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_task</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the task configuration.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if task is available and valid</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">manual_run</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="n">resolve_task</span><span class="p">(</span><span class="n">task_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_setup_info</span><span class="p">(</span><span class="s1">&#39;task_idx&#39;</span><span class="p">))</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="ethopy.core.logger.Logger.log" class="doc doc-heading">
<code class="highlight language-python"><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#ethopy.core.logger.Logger.log" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Log the given data into the specified table in the experiment database.</p>
<p>It first gets the elapsed time from the logger timer and adds it to the data
dictionary. It then puts the data into the specified table.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>table</code></td>
        <td><code>str</code></td>
        <td><p>The name of the table in the experiment database.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>data</code></td>
        <td><code>dict</code></td>
        <td><p>The data to be logged. Defaults to an empty
dictionary.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Dict[str, Any]</code></td>
        <td><p>Additional keyword arguments to be passed to the put method.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>float</code></td>
      <td><p>The elapsed time from the logger timer.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ethopy/core/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">log</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log the given data into the specified table in the experiment database.</span>

<span class="sd">    It first gets the elapsed time from the logger timer and adds it to the data</span>
<span class="sd">    dictionary. It then puts the data into the specified table.</span>

<span class="sd">    Args:</span>
<span class="sd">        table (str): The name of the table in the experiment database.</span>
<span class="sd">        data (dict, optional): The data to be logged. Defaults to an empty</span>
<span class="sd">            dictionary.</span>
<span class="sd">        **kwargs: Additional keyword arguments to be passed to the put method.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The elapsed time from the logger timer.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tmst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger_timer</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="ow">or</span> <span class="p">{}</span>  <span class="c1"># if data is None or False use an empty dictionary</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="p">,</span> <span class="nb">tuple</span><span class="o">=</span><span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">tmst</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">table</span> <span class="o">==</span> <span class="s2">&quot;Trial.StateOnset&quot;</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;State: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">tmst</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="ethopy.core.logger.Logger.log_recording" class="doc doc-heading">
<code class="highlight language-python"><span class="n">log_recording</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rec_key</span><span class="p">)</span></code>


<a href="#ethopy.core.logger.Logger.log_recording" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Log a new recording entry with an incremented recording index.</p>
<p>This method retrieves the current recordings associated with the trial,
calculates the next recording index (rec_idx) by finding the maximum
recording index and adding one, and logs the new recording entry with
the provided recording key (rec_key) and the calculated recording index.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>rec_key</code></td>
        <td><code>dict</code></td>
        <td><p>A dictionary containing the key information for the recording</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>      <p>entry.</p>
<p>The method assumes the existence of a <code>get</code> method to retrieve existing
recordings and a <code>log</code> method to log the new recording entry.</p>

        <details class="quote">
          <summary>Source code in <code>ethopy/core/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">log_recording</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rec_key</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log a new recording entry with an incremented recording index.</span>

<span class="sd">    This method retrieves the current recordings associated with the trial,</span>
<span class="sd">    calculates the next recording index (rec_idx) by finding the maximum</span>
<span class="sd">    recording index and adding one, and logs the new recording entry with</span>
<span class="sd">    the provided recording key (rec_key) and the calculated recording index.</span>

<span class="sd">    Args:</span>
<span class="sd">        rec_key (dict): A dictionary containing the key information for the recording</span>
<span class="sd">    entry.</span>

<span class="sd">    The method assumes the existence of a `get` method to retrieve existing</span>
<span class="sd">    recordings and a `log` method to log the new recording entry.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">recs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">schema</span><span class="o">=</span><span class="s2">&quot;recording&quot;</span><span class="p">,</span>
        <span class="n">table</span><span class="o">=</span><span class="s2">&quot;Recording&quot;</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;rec_idx&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">rec_idx</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">recs</span> <span class="k">else</span> <span class="nb">max</span><span class="p">(</span><span class="n">recs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Recording&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="o">**</span><span class="n">rec_key</span><span class="p">,</span> <span class="s1">&#39;rec_idx&#39;</span><span class="p">:</span> <span class="n">rec_idx</span><span class="p">},</span> <span class="n">schema</span><span class="o">=</span><span class="s1">&#39;recording&#39;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="ethopy.core.logger.Logger.log_session" class="doc doc-heading">
<code class="highlight language-python"><span class="n">log_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_params</span><span class="p">,</span> <span class="n">experiment_type</span><span class="p">,</span> <span class="n">log_task</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#ethopy.core.logger.Logger.log_session" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Log session with the given parameters and optionally log the task.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>session_params</code></td>
        <td><code>Dict[str, Any]</code></td>
        <td><p>Parameters for the session.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>experiment_type</code></td>
        <td><code>str</code></td>
        <td><p>current experiment running in session.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>log_task</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to log the task information.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ethopy/core/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">log_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">session_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
                <span class="n">experiment_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="n">log_task</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log session with the given parameters and optionally log the task.</span>

<span class="sd">    Args:</span>
<span class="sd">        session_params (Dict[str, Any]): Parameters for the session.</span>
<span class="sd">        experiment_type (str): current experiment running in session.</span>
<span class="sd">        log_task (bool): Whether to log the task information.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initializes session parameters and logs the session start.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_init_session_params</span><span class="p">(</span><span class="n">session_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_name&quot;</span><span class="p">,</span> <span class="s2">&quot;bot&quot;</span><span class="p">),</span>
                              <span class="n">experiment_type</span><span class="p">)</span>

    <span class="c1"># Save the task file, name and the git_hash in the database.</span>
    <span class="k">if</span> <span class="n">log_task</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_task_details</span><span class="p">()</span>

    <span class="c1"># update the configuration tables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_session_configs</span><span class="p">(</span><span class="n">session_params</span><span class="p">[</span><span class="s2">&quot;setup_conf_idx&quot;</span><span class="p">])</span>

    <span class="c1">#  Init the informations(e.g. trial_id=0, session) in control table</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_init_control_table</span><span class="p">(</span><span class="n">session_params</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">logger_timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># Start session time</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="ethopy.core.logger.Logger.log_session_configs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">log_session_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup_conf_idx</span><span class="p">)</span></code>


<a href="#ethopy.core.logger.Logger.log_session_configs" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Log parameter of a session into the appropriate schema tables.</p>
<p>This method performs several key operations to ensure that the configuration of
a session, including behavior and stimulus settings, is accurately logged into
the database. It involves the following steps:
1. Identifies the relevant modules (e.g., ethopy.core.interface) that contain
Configuration classes.
2. Derives schema names from these modules, assuming the schema name matches the
class name in lowercase.
3. Logs the session and animal_id into the Configuration tables of the
identified schemas.
4. Creates a dictionary mapping each schema to its respective Configuration
class's inner classes.
5. Calls a helper method to log the configuration of sub-tables for each schema.</p>

        <details class="quote">
          <summary>Source code in <code>ethopy/core/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">log_session_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup_conf_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log parameter of a session into the appropriate schema tables.</span>

<span class="sd">    This method performs several key operations to ensure that the configuration of</span>
<span class="sd">    a session, including behavior and stimulus settings, is accurately logged into</span>
<span class="sd">    the database. It involves the following steps:</span>
<span class="sd">    1. Identifies the relevant modules (e.g., ethopy.core.interface) that contain</span>
<span class="sd">    Configuration classes.</span>
<span class="sd">    2. Derives schema names from these modules, assuming the schema name matches the</span>
<span class="sd">    class name in lowercase.</span>
<span class="sd">    3. Logs the session and animal_id into the Configuration tables of the</span>
<span class="sd">    identified schemas.</span>
<span class="sd">    4. Creates a dictionary mapping each schema to its respective Configuration</span>
<span class="sd">    class&#39;s inner classes.</span>
<span class="sd">    5. Calls a helper method to log the configuration of sub-tables for each schema.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># modules that have a Configuration classes</span>
    <span class="n">_modules</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ethopy.core.interface&#39;</span><span class="p">]</span>
    <span class="c1"># consider that the module have the same name as the schema but in lower case</span>
    <span class="c1"># (e.g for class Behaviour the schema is the behavior)</span>
    <span class="n">_schemas</span> <span class="o">=</span> <span class="p">[</span><span class="n">_module</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">_module</span> <span class="ow">in</span> <span class="n">_modules</span><span class="p">]</span>

    <span class="c1"># Logs the session and animal_id in configuration tables of behavior/stimulus.</span>
    <span class="k">for</span> <span class="n">schema</span> <span class="ow">in</span> <span class="n">_schemas</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="s2">&quot;Configuration&quot;</span><span class="p">,</span>
                 <span class="nb">tuple</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">,</span>
                 <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
                 <span class="n">priority</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                 <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,)</span>

    <span class="c1"># create a dict with the configuration as key and the subclasses as values</span>
    <span class="n">conf_table_schema</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">_schema</span><span class="p">,</span> <span class="n">_module</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_schemas</span><span class="p">,</span> <span class="n">_modules</span><span class="p">):</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">_module</span><span class="p">)</span><span class="o">.</span><span class="n">Configuration</span>
        <span class="c1"># Find the inner classes of the class Configuration</span>
        <span class="n">conf_table_schema</span><span class="p">[</span><span class="n">_schema</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inner_classes_list</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>

    <span class="c1"># update the sub tables of Configuration table</span>
    <span class="k">for</span> <span class="n">schema</span><span class="p">,</span> <span class="n">config_tables</span> <span class="ow">in</span> <span class="n">conf_table_schema</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_sub_tables_config</span><span class="p">(</span><span class="n">setup_conf_idx</span><span class="p">,</span> <span class="n">config_tables</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="ethopy.core.logger.Logger.put" class="doc doc-heading">
<code class="highlight language-python"><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#ethopy.core.logger.Logger.put" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Put an item in the queue.</p>
<p>This method creates a <code>PrioritizedItem</code> from the given keyword arguments and
puts it into the queue. After putting an item in the queue, it checks the
'block' attribute of the item. If 'block' is False, it marks the item as
processed by calling <code>task_done()</code>. This is useful in scenarios where items are
processed asynchronously, and the queue needs to be notified that a task is
complete. If 'block' is True, it waits for all items in the queue to be
processed by calling <code>join()</code>.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Any</code></td>
        <td><p>The keyword arguments used to create a <code>PrioritizedItem</code> and
put it in the queue.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ethopy/core/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Put an item in the queue.</span>

<span class="sd">    This method creates a `PrioritizedItem` from the given keyword arguments and</span>
<span class="sd">    puts it into the queue. After putting an item in the queue, it checks the</span>
<span class="sd">    &#39;block&#39; attribute of the item. If &#39;block&#39; is False, it marks the item as</span>
<span class="sd">    processed by calling `task_done()`. This is useful in scenarios where items are</span>
<span class="sd">    processed asynchronously, and the queue needs to be notified that a task is</span>
<span class="sd">    complete. If &#39;block&#39; is True, it waits for all items in the queue to be</span>
<span class="sd">    processed by calling `join()`.</span>

<span class="sd">    Args:</span>
<span class="sd">        **kwargs (Any): The keyword arguments used to create a `PrioritizedItem` and</span>
<span class="sd">            put it in the queue.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">PrioritizedItem</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">block</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="ethopy.core.logger.Logger.setup_schema" class="doc doc-heading">
<code class="highlight language-python"><span class="n">setup_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra_schema</span><span class="p">)</span></code>


<a href="#ethopy.core.logger.Logger.setup_schema" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Set up additional schema.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>extra_schema</code></td>
        <td><code>Dict[str, Any]</code></td>
        <td><p>The additional schema to set up.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ethopy/core/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">setup_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra_schema</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up additional schema.</span>

<span class="sd">    Args:</span>
<span class="sd">        extra_schema (Dict[str, Any]): The additional schema to set up.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">schema</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">extra_schema</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">globals</span><span class="p">()[</span><span class="n">schema</span><span class="p">]</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">create_virtual_module</span><span class="p">(</span>
            <span class="n">schema</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">create_tables</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">create_schema</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_schemata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">schema</span><span class="p">:</span> <span class="n">dj</span><span class="o">.</span><span class="n">create_virtual_module</span><span class="p">(</span>
                    <span class="n">schema</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">private_conn</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="ethopy.core.logger.Logger.update_setup_info" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update_setup_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#ethopy.core.logger.Logger.update_setup_info" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Update the setup information in Control table with the provided info and key.</p>
<p>It first fetches the existing setup information from the experiment's Control
table, then updates it with the provided info. If 'status' is in the provided
info, it blocks and validates the update operation.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>info</code></td>
        <td><code>dict</code></td>
        <td><p>The information to update the setup with.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>key</code></td>
        <td><code>dict</code></td>
        <td><p>Additional keys to fetch the setup information with.
Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>      <p>Side Effects:
    Updates the setup_info attribute with the new setup information.
    Updates the setup_status attribute with the new status.</p>

        <details class="quote">
          <summary>Source code in <code>ethopy/core/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">update_setup_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">info</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
                      <span class="n">key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the setup information in Control table with the provided info and key.</span>

<span class="sd">    It first fetches the existing setup information from the experiment&#39;s Control</span>
<span class="sd">    table, then updates it with the provided info. If &#39;status&#39; is in the provided</span>
<span class="sd">    info, it blocks and validates the update operation.</span>

<span class="sd">    Args:</span>
<span class="sd">        info (dict): The information to update the setup with.</span>
<span class="sd">        key (dict, optional): Additional keys to fetch the setup information with.</span>
<span class="sd">            Defaults to None.</span>

<span class="sd">    Side Effects:</span>
<span class="sd">        Updates the setup_info attribute with the new setup information.</span>
<span class="sd">        Updates the setup_status attribute with the new status.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_exception</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread_exception</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Thread exception occurred: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_exception</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">public_conn</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
        <span class="n">_set_connection</span><span class="p">()</span>

    <span class="n">block</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="s2">&quot;status&quot;</span> <span class="ow">in</span> <span class="n">info</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
        <span class="n">caller</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">caller_info</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Function called by </span><span class="si">{</span><span class="n">caller</span><span class="o">.</span><span class="n">function</span><span class="si">}</span><span class="s2"> &quot;</span>
                       <span class="sa">f</span><span class="s2">&quot;in </span><span class="si">{</span><span class="n">caller</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2"> at line </span><span class="si">{</span><span class="n">caller</span><span class="o">.</span><span class="n">lineno</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Update status is set </span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">],</span> <span class="n">caller_info</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">setup_info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="o">**</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">Control</span><span class="p">()</span> <span class="o">&amp;</span> <span class="p">{</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;setup&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">},</span> <span class="o">**</span><span class="n">key</span><span class="p">})</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(),</span>
        <span class="o">**</span><span class="n">info</span>
        <span class="p">}</span>

    <span class="k">if</span> <span class="s1">&#39;notes&#39;</span> <span class="ow">in</span> <span class="n">info</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;notes&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">:</span>
        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;notes&#39;</span><span class="p">][:</span><span class="mi">255</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
        <span class="n">table</span><span class="o">=</span><span class="s2">&quot;Control&quot;</span><span class="p">,</span>
        <span class="nb">tuple</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">setup_info</span><span class="p">,</span>
        <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">,</span>
        <span class="n">validate</span><span class="o">=</span><span class="n">block</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setup_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_info</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="ethopy.core.logger.Logger.update_trial_idx" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update_trial_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial_idx</span><span class="p">)</span></code>


<a href="#ethopy.core.logger.Logger.update_trial_idx" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Update trial index.</p>
<p>Updates the trial index in the trial_key dictionary and check if there is any
exception in the threads.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>trial_idx</code></td>
        <td><code>int</code></td>
        <td><p>The new trial index to be updated.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>ethopy/core/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">update_trial_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update trial index.</span>

<span class="sd">    Updates the trial index in the trial_key dictionary and check if there is any</span>
<span class="sd">    exception in the threads.</span>

<span class="sd">    Args:</span>
<span class="sd">        trial_idx (int): The new trial index to be updated.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">[</span><span class="s1">&#39;trial_idx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trial_idx</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Trial idx: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">trial_key</span><span class="p">[</span><span class="s1">&#39;trial_idx&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_exception</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread_exception</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Thread exception occurred: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_exception</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 id="ethopy.core.logger.PrioritizedItem" class="doc doc-heading">
        <code>
PrioritizedItem        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#ethopy.core.logger.PrioritizedItem" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>PrioritizedItem(table: str, tuple: Any, field: str = '', value: Any = '', schema: str = 'experiment', replace: bool = False, block: bool = False, validate: bool = False, priority: int = 50, error: bool = False, ignore_extra_fields: bool = True)</p>

        <details class="quote">
          <summary>Source code in <code>ethopy/core/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">PrioritizedItem</span><span class="p">:</span>
    <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">datafield</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">tuple</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">datafield</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">datafield</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">datafield</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">datafield</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;experiment&#39;</span><span class="p">)</span>
    <span class="n">replace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">datafield</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">block</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">datafield</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">datafield</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">datafield</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">datafield</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ignore_extra_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">datafield</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">





























  </div>

    </div>

  </div>







  </div>

    </div>

  </div>












                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 - 2024 Alex Evangelou
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.top", "search.highlight", "search.share"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.081f42fc.min.js"></script>
      
    
  </body>
</html>